---
article: false
title: 安装
order: 1
date: 2023-03-20 22:10:47
---
[[toc]]

# 安装
## docker安装
1. Gitlab镜像
```
docker search gitlab
```
2. 拉取Gitlab镜像
```
# 拉取Gitlab镜像
docker pull gitlab/gitlab-ce:latest
```
3. 启动容器
```
# 启动容器
docker run \
 -itd  \
 -p 10080:80 \
 -p 10022:22 \
 -v /usr/local/docker/Gitlab/etc:/etc/gitlab  \
 -v /usr/local/docker/Gitlab/log:/var/log/gitlab \
 -v /usr/local/docker/Gitlab/opt:/var/opt/gitlab \
 --restart always \
 --privileged=true \
 --name gitlab \
 gitlab/gitlab-ce
```
|命令|	描述|
|  ----  | ----  |
|-i	 |以交互模式运行容器，通常与 -t 同时使用命令解释
|-t	| 为容器重新分配一个伪输入终端，通常与 -i 同时使用
|-d	|后台运行容器，并返回容器ID
|-p |9980:80	将容器内80端口映射至宿主机9980端口，这是访问gitlab的端口
|-p |9922:22	 将容器内22端口映射至宿主机9922端口，这是访问ssh的端口
|-v |/home/gitlab/etc:/etc/gitlab	将容器/etc/gitlab目录挂载到宿主机/usr/local/gitlab-test/etc目录下，若宿主机内此目录不存在将会自动创建，其他两个挂载同这个一样
|--restart always	|容器自启动
|--privileged=true	|让容器获取宿主机root权限
|--name gitlab	|设置容器名称为gitlab
|gitlab/gitlab-ce	|镜像的名称，这里也可以写镜像ID

4. 修改配置
```
#进容器内部
docker exec -it gitlab /bin/bash
 
#修改gitlab.rb
vi /etc/gitlab/gitlab.rb
 
#加入如下
#gitlab访问地址，可以写域名。如果端口不写的话默认为80端口
external_url 'http://192.168.124.194'
#ssh主机ip
gitlab_rails['gitlab_ssh_host'] = '192.168.124.194'
#ssh连接端口
gitlab_rails['gitlab_shell_ssh_port'] = 9922
 
# 让配置生效
gitlab-ctl reconfigure
```
>  注意不要重启，/etc/gitlab/gitlab.rb文件的配置会映射到gitlab.yml这个文件，由于咱们在docker中运行，在gitlab上生成的http地址应该是http://192.168.124.194:9980,所以，要修改下面文件

```
# 修改http和ssh配置
vi /opt/gitlab/embedded/service/gitlab-rails/config/gitlab.yml
 
  gitlab:
    host: 192.168.124.194
    port: 9980 # 这里改为9980
    https: false
```
```
#重启gitlab 
gitlab-ctl restart
#退出容器 
exit
```